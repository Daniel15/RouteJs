/*!
 * RouteJs by Daniel Lo Nigro (Daniel15) - http://dl.vc/routejs
 * Version {VERSION}
 * Released under the BSD license.
 */
(function(n){"use strict";function u(n,t){var r={};for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);for(i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r}function f(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var i,t,r;i=Array.prototype.indexOf?function(n,t){return n.indexOf(t)}:function(n,t){for(var i=0,r=n.length;i<r;i++)if(n[i]===t)return i;return-1};t=function(n,t){var r=/\{(\w+)\}/g,i;for(n.optional||(n.optional=[]),this.settings=u({lowerCaseUrls:!1},t),this.route=n,this._params=[];(i=r.exec(this.route.url))!==null;)this._params.push(i[1].toLowerCase())};t.prototype={build:function(n){var e={},t,i,r,f;for(t in n)n.hasOwnProperty(t)&&(e[t.toLowerCase()]=n[t]);return(i=u(this.route.defaults,e),r={controller:!0,action:!0},this.route.defaults.area&&this.route.defaults.area.toLowerCase()!==(e.area||"").toLowerCase())?null:!this._checkConstraints(i)||!this._checkNonDefaultValues(i,r)?null:(f=this._merge(i,r),f===null)?null:this._trimOptional(f)+this._extraParams(n,r,f.indexOf("?")>-1)},_checkNonDefaultValues:function(n,t){for(var r in this.route.defaults)if(this.route.defaults.hasOwnProperty(r)){if((this.route.defaults[r]+"").toLowerCase()!==(n[r]+"").toLowerCase()&&i(this._params,r)===-1)return!1;t[r]=!0}return!0},_merge:function(n,t){for(var s,h,u=this.settings.lowerCaseUrls?this.route.url.toLowerCase():this.route.url,e=0,c=this._params.length;e<c;e++){var r=this._params[e],o=n[r]!==undefined,l=i(this.route.optional,r)>-1;if(!o&&!l)return null;o&&(s=new RegExp("{"+f(r)+"}","i"),h=this.settings.lowerCaseUrls&&this._shouldConvertParam(r)?n[r].toLowerCase():n[r],u=u.replace(s,encodeURIComponent(h)));t[r]=!0}return u},_trimOptional:function(n){for(var t=n.split("/"),i=t.length-1;i>=0;i--)t[i].indexOf("{")>-1&&t.splice(i,1);return t.join("/")},_extraParams:function(n,t,i){var u="";for(var r in n)t[r.toLowerCase()]||(u+=(i?"&":"?")+encodeURIComponent(r)+"="+encodeURIComponent(n[r]),i=!0);return u},_checkConstraints:function(n){if(!this.route.constraints)return!0;this._parsedConstraints||(this._parsedConstraints=this._parseConstraints());for(var t in this._parsedConstraints)if(this._parsedConstraints.hasOwnProperty(t)&&!this._parsedConstraints[t].test(n[t]))return!1;return!0},_parseConstraints:function(){var t={};for(var n in this.route.constraints)this.route.constraints.hasOwnProperty(n)&&(t[n.toLowerCase()]=new RegExp("^("+this.route.constraints[n].replace(/\\/g,"\\")+")$","i"));return t},_shouldConvertParam:function(n){return n==="controller"||n==="action"||n==="area"}};r=function(n){var r,i,u;for(this.baseUrl=n.baseUrl,this.lowerCaseUrls=n.lowerCaseUrls,this.routes=[],r={lowerCaseUrls:this.lowerCaseUrls},i=0,u=n.routes.length;i<u;i++)this.routes.push(new t(n.routes[i],r))};r.prototype={action:function(t,i,r){return r=r||{},r.controller=t||n.RouteJs.activeController,r.action=i,this.route(r)},route:function(n){for(var i,t=0,r=this.routes.length;t<r;t++)if(i=this.routes[t].build(n),i)return this.baseUrl+i;throw new Error("No route could be matched to route values: "+n);}};n.RouteJs={version:"{VERSION}",Route:t,RouteManager:r}})(window);